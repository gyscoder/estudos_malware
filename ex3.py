import socket
import re

class ConexaoAtacante:
    def __init__(self, endereco_irc, nick):
        self.socket = socket.socket()
        self.socket.connect(endereco_irc)
        self.registra_usuario(nick)
        self.nick = nick
    
    def envia_comando(self, cmd):
        cmd += '\r\n'
        self.socket.send(cmd.encode('utf8'))
        
    def recebe_comando(self):
        msg = self.socket.recv(4096)
        msg = msg.decode('utf8', errors='ignore')
        self.responde_ping(msg)
        return msg
    
    def registra_usuario(self, nick):
        self.envia_comando('NICK ' + nick)
        self.envia_comando('USER {0} {0} {0} :{0}'.format(nick))
        
    def responde_ping(self, msg):
        match = re.match('PING :(.*)', msg)
        if match:
            pong = match.group(1)
            self.envia_comando('PONG: ' + pong)
            
conexao = ConexaoAtacante(('irc.python.net', 6667), 'MalwareBot')
while True:
    cmd = conexao.recebe_comando()